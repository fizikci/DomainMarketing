ace.define("ace/ext/elastic_tabstops_lite",["require","exports","module","ace/editor","ace/config"],function(n,t){var i=function(n){this.$editor=n;var r=this,t=[],i=!1;this.onAfterExec=function(){i=!1;r.processRows(t);t=[]};this.onExec=function(){i=!0};this.onChange=function(n){var r=n.data.range;i&&(t.indexOf(r.start.row)==-1&&t.push(r.start.row),r.end.row!=r.start.row&&t.push(r.end.row))}},r;(function(){this.processRows=function(n){var r,t,e,u,i,h,c;for(this.$inChange=!0,r=[],t=0,e=n.length;t<e;t++)if(u=n[t],!(r.indexOf(u)>-1)){var o=this.$findCellWidthsForBlock(u),s=this.$setBlockCellWidthsToMax(o.cellWidths),f=o.firstRow;for(i=0,h=s.length;i<h;i++)c=s[i],r.push(f),this.$adjustRow(f,c),f++}this.$inChange=!1};this.$findCellWidthsForBlock=function(n){for(var r=[],i,t=n,u,f;t>=0;){if(i=this.$cellWidthsForRow(t),i.length==0)break;r.unshift(i);t--}for(u=t+1,t=n,f=this.$editor.session.getLength();t<f-1;){if(t++,i=this.$cellWidthsForRow(t),i.length==0)break;r.push(i)}return{cellWidths:r,firstRow:u}};this.$cellWidthsForRow=function(n){for(var e=this.$selectionColumnsForRow(n),i=[-1].concat(this.$tabsForRow(n)),r=i.map(function(){return 0}).slice(1),o=this.$editor.session.getLine(n),t=0,s=i.length-1;t<s;t++){var u=i[t]+1,f=i[t+1],h=this.$rightmostSelectionInCell(e,f),c=o.substring(u,f);r[t]=Math.max(c.replace(/\s+$/g,"").length,h-u)}return r};this.$selectionColumnsForRow=function(n){var t=[],i=this.$editor.getCursorPosition();return this.$editor.session.getSelection().isEmpty()&&n==i.row&&t.push(i.column),t};this.$setBlockCellWidthsToMax=function(n){for(var t,i,l,o,f,e=!0,s,h,r,c=this.$izip_longest(n),u=0,a=c.length;u<a;u++){if(t=c[u],!t.push){console.error(t);continue}for(t.push(NaN),i=0,l=t.length;i<l;i++){if(o=t[i],e&&(s=i,r=0,e=!1),isNaN(o)){for(h=i,f=s;f<h;f++)n[f][u]=r;e=!0}r=Math.max(r,o)}}return n};this.$rightmostSelectionInCell=function(n,t){var u=0,r,i,f;if(n.length){for(r=[],i=0,f=n.length;i<f;i++)n[i]<=t?r.push(i):r.push(0);u=Math.max.apply(Math,r)}return u};this.$tabsForRow=function(n){for(var t=[],r=this.$editor.session.getLine(n),u=/\t/g,i;(i=u.exec(r))!=null;)t.push(i.index);return t};this.$adjustRow=function(n,t){var o=this.$tabsForRow(n),u,h,c,i,r;if(o.length!=0){var f=0,s=-1,e=this.$izip(t,o);for(u=0,h=e.length;u<h;u++)if(c=e[u][0],i=e[u][1],s+=1+c,i+=f,r=s-i,r!=0){var l=this.$editor.session.getLine(n).substr(0,i),a=l.replace(/\s*$/g,""),v=l.length-a.length;r>0&&(this.$editor.session.getDocument().insertInLine({row:n,column:i+1},Array(r+1).join(" ")+"\t"),this.$editor.session.getDocument().removeInLine(n,i,i+1),f+=r);r<0&&v>=-r&&(this.$editor.session.getDocument().removeInLine(n,i+r,i),f+=r)}}};this.$izip_longest=function(n){var r,f,e,o,i,u,t;if(!n[0])return[];for(r=n[0].length,f=n.length,t=1;t<f;t++)e=n[t].length,e>r&&(r=e);for(o=[],i=0;i<r;i++){for(u=[],t=0;t<f;t++)n[t][i]===""?u.push(NaN):u.push(n[t][i]);o.push(u)}return o};this.$izip=function(n,t){for(var u,f=n.length>=t.length?t.length:n.length,r=[],i=0;i<f;i++)u=[n[i],t[i]],r.push(u);return r}}).call(i.prototype);t.ElasticTabstopsLite=i;r=n("../editor").Editor;n("../config").defineOptions(r.prototype,"editor",{useElasticTabstops:{set:function(n){n?(this.elasticTabstops||(this.elasticTabstops=new i(this)),this.commands.on("afterExec",this.elasticTabstops.onAfterExec),this.commands.on("exec",this.elasticTabstops.onExec),this.on("change",this.elasticTabstops.onChange)):this.elasticTabstops&&(this.commands.removeListener("afterExec",this.elasticTabstops.onAfterExec),this.commands.removeListener("exec",this.elasticTabstops.onExec),this.removeListener("change",this.elasticTabstops.onChange))}}})});