var Window=Class.create();Window.keepMultiModalWindow=!1;Window.prototype={initialize:function(){var n,i=0,t;arguments.length>0&&(typeof arguments[0]=="string"?(n=arguments[0],i=1):n=arguments[0]?arguments[0].id:null);n||(n="window_"+(new Date).getTime());$("#"+n).length&&alert("Window "+n+" is already registered in the DOM! Make sure you use setDestroyOnClose() or destroyOnClose: true in the constructor");this.hasEffectLib=String.prototype.parseColor!=null;this.options=Object.extend({minWidth:100,minHeight:20,resizable:!0,closable:!0,minimizable:!0,maximizable:!0,draggable:!0,userData:null,effectOptions:null,parent:document.body,title:"&nbsp;",url:null,onload:Prototype.emptyFunction,width:200,height:300,opacity:1,recenterAuto:!0,wiredDrag:!1,closeCallback:null,destroyOnClose:!1},arguments[i]||{});typeof this.options.top=="undefined"&&typeof this.options.bottom=="undefined"&&(this.options.top=Math.random()*500);typeof this.options.left=="undefined"&&typeof this.options.right=="undefined"&&(this.options.left=Math.random()*500);this.options.parent!=document.body&&(this.options.parent=$(this.options.parent));this.element=this._createWindow(n);this.eventMouseDown=this._initDrag.bindAsEventListener(this);this.eventMouseUp=this._endDrag.bindAsEventListener(this);this.eventMouseMove=this._updateDrag.bindAsEventListener(this);this.eventOnLoad=this._getWindowBorderSize.bindAsEventListener(this);this.eventMouseDownContent=this.toFront.bindAsEventListener(this);this.eventResize=this._recenter.bindAsEventListener(this);this.topbar=$("#"+this.element.attr("id")+"_top");this.bottombar=$("#"+this.element.attr("id")+"_bottom");this.content=$("#"+this.element.attr("id")+"_content");this.topbar.bind("mousedown",this.eventMouseDown);this.bottombar.bind("mousedown",this.eventMouseDown);this.content.bind("mousedown",this.eventMouseDownContent);$(window).bind("load",this.eventOnLoad);$(window).bind("resize",this.eventResize);$(window).bind("scroll",this.eventResize);this.options.draggable&&(t=this,[this.topbar,this.topbar.parent().prev(),this.topbar.parent().next()].each(function(n){n.bind("mousedown",t.eventMouseDown);n.addClass("top_draggable")}),[this.bottombar.parent(),this.bottombar.parent().prev(),this.bottombar.parent().next()].each(function(n){n.bind("mousedown",t.eventMouseDown);n.addClass("bottom_draggable")}));this.options.resizable&&(this.sizer=$("#"+this.element.attr("id")+"_sizer"),this.sizer.bind("mousedown",this.eventMouseDown));this.useLeft=typeof this.options.left!="undefined";this.useTop=typeof this.options.top!="undefined";this.useLeft&&this.useTop&&this.setLocation(parseFloat(this.options.top),parseFloat(this.options.left));this.storedLocation=null;this.setOpacity(this.options.opacity);this.options.zIndex&&this.setZIndex(this.options.zIndex);this.options.destroyOnClose&&this.setDestroyOnClose(!0);this._getWindowBorderSize();this.width=this.options.width;this.height=this.options.height;this.visible=!1;this.constraint=!1;this.constraintPad={top:0,left:0,bottom:0,right:0};this.width&&this.height&&this.setSize(this.options.width,this.options.height);this.setTitle(this.options.title);Windows.register(this)},destroy:function(){var i,n,t;if(this._notify("onDestroy"),this.topbar.unbind("mousedown",this.eventMouseDown),this.bottombar.unbind("mousedown",this.eventMouseDown),this.content.unbind("mousedown",this.eventMouseDownContent),$(window).unbind("load",this.eventOnLoad),$(window).unbind("resize",this.eventResize),$(window).unbind("scroll",this.eventResize),this.content.unbind("load",this.options.onload),this._oldParent&&this._oldParent.length){for(i=this.getContent(),n=null,t=0;t<i.childNodes.length;t++){if(n=i.childNodes[t],n.nodeType==1)break;n=null}n&&this._oldParent.append(n);this._oldParent=null}this.sizer&&this.sizer.unbind("mousedown",this.eventMouseDown);this.options.url&&(this.content.src=null);this.iefix&&this.iefix.remove();this.element.remove();Windows.unregister(this)},setCloseCallback:function(n){this.options.closeCallback=n},getContent:function(){return this.content},setContent:function(n,t,i){var r=$("#"+n),u,f,e;if(null==r)throw"Unable to find element '"+n+"' in DOM";this._oldParent=r.parent();u=null;f=null;t&&(u=getDimensions(r));i&&(f=r.offset());e=this.getContent();this.setHTMLContent("");e=this.getContent();e.appendChild(r);r.show();t&&this.setSize(u.width,u.height);i&&this.setLocation(f.left-this.heightN,f.top-this.widthW)},setHTMLContent:function(n){if(this.options.url){this.content.src=null;this.options.url=null;var t='<div id="'+this.getId()+'_content" class="'+this.options.className+'_content"> <\/div>';$("#"+this.getId()+"_table_content").html(t);this.content=$("#"+this.getId()+"_content")}this.getContent().html(n)},setURL:function(n){if(this.options.url)this.options.url=n,$("#"+this.getId()+"_content").src=n;else{this.options.url=n;var t='<iframe frameborder="0" name="'+this.getId()+'_content"  id="'+this.getId()+'_content" src="'+n+'"> <\/iframe>';$("#"+this.getId()+"_table_content").html(t);this.content=$("#"+this.getId()+"_content")}},getURL:function(){return this.options.url?this.options.url:null},refresh:function(){this.options.url&&($("#"+this.getId()+"_content").src=this.options.url)},setCookie:function(n,t,i,r,u){var e;if(n=n||this.element.attr("id"),this.cookie=[n,t,i,r,u],e=WindowUtilities.getCookie(n),e){var f=e.split(","),o=f[0].split(":"),s=f[1].split(":"),h=parseFloat(f[2]),c=parseFloat(f[3]),l=f[4],a=f[5];this.setSize(h,c);l=="true"?this.doMinimize=!0:a=="true"&&(this.doMaximize=!0);this.useLeft=o[0]=="l";this.useTop=s[0]=="t";this.element.css(this.useLeft?{left:o[1]}:{right:o[1]});this.element.css(this.useTop?{top:s[1]}:{bottom:s[1]})}},getId:function(){return this.element.attr("id")},setDestroyOnClose:function(){this.options.destroyOnClose=!0},setConstraint:function(n,t){this.constraint=n;this.constraintPad=Object.extend(this.constraintPad,t||{});this.useTop&&this.useLeft&&this.setLocation(parseFloat(this.element.css("top")),parseFloat(this.element.css("left")))},_initDrag:function(n){if(($(n.target)!=this.sizer||!this.isMinimized())&&($(n.target)==this.sizer||!this.isMaximized())){if(isIE&&this.heightN==0&&this._getWindowBorderSize(),this.pointer=[n.pageX,n.pageY],this.currentDrag=this.options.wiredDrag?this._createWiredElement():this.element,$(n.target)==this.sizer)this.doResize=!0,this.widthOrg=this.width,this.heightOrg=this.height,this.bottomOrg=parseFloat(this.element.css("bottom")),this.rightOrg=parseFloat(this.element.css("right")),this._notify("onStartResize");else{this.doResize=!1;var t=$("#"+this.getId()+"_close");if(t&&t.is(":hover")){this.currentDrag=null;return}if(this.toFront(),!this.options.draggable)return;this._notify("onStartMove")}$(document).bind("mouseup",this.eventMouseUp);$(document).bind("mousemove",this.eventMouseMove);WindowUtilities.disableScreen("__invisible__","__invisible__");document.body.ondrag=function(){return!1};document.body.onselectstart=function(){return!1};this.currentDrag.show();n.stopPropagation()}},_updateDrag:function(n){var f=[n.pageX,n.pageY],t=f[0]-this.pointer[0],i=f[1]-this.pointer[1],r,u,e,o,s,h;this.doResize?(r=this.widthOrg+t,u=this.heightOrg+i,t=this.width-this.widthOrg,i=this.height-this.heightOrg,this.useLeft?r=this._updateWidthConstraint(r):this.currentDrag.css({right:this.rightOrg-t+"px"}),this.useTop?u=this._updateHeightConstraint(u):this.currentDrag.css({bottom:this.bottomOrg-i+"px"}),this.setSize(r,u),this._notify("onResize")):(this.pointer=f,this.useLeft?(e=parseFloat(this.currentDrag.css("left"))+t,o=this._updateLeftConstraint(e),this.pointer[0]+=o-e,this.currentDrag.css({left:o+"px"})):this.currentDrag.css({right:parseFloat(this.currentDrag.css("right"))-t+"px"}),this.useTop?(s=parseFloat(this.currentDrag.css("top"))+i,h=this._updateTopConstraint(s),this.pointer[1]+=h-s,this.currentDrag.css({top:h+"px"})):this.currentDrag.css({bottom:parseFloat(this.currentDrag.css("bottom"))-i+"px"}),this._notify("onMove"));this.iefix&&this._fixIEOverlapping();this._removeStoreLocation();n.stopPropagation()},_endDrag:function(n){WindowUtilities.enableScreen("__invisible__");this.doResize?this._notify("onEndResize"):this._notify("onEndMove");$(document).unbind("mouseup",this.eventMouseUp,!1);$(document).unbind("mousemove",this.eventMouseMove,!1);n.stopPropagation();this._hideWiredElement();this._saveCookie();document.body.ondrag=null;document.body.onselectstart=null},_updateLeftConstraint:function(n){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowWidth:getDimensions(this.options.parent).width;n<this.constraintPad.left&&(n=this.constraintPad.left);n+this.width+this.widthE+this.widthW>t-this.constraintPad.right&&(n=t-this.constraintPad.right-this.width-this.widthE-this.widthW)}return n},_updateTopConstraint:function(n){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:getDimensions(this.options.parent).height,i=this.height+this.heightN+this.heightS;n<this.constraintPad.top&&(n=this.constraintPad.top);n+i>t-this.constraintPad.bottom&&(n=t-this.constraintPad.bottom-i)}return n},_updateWidthConstraint:function(n){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowWidth:getDimensions(this.options.parent).width,i=parseFloat(this.element.css("left"));i+n+this.widthE+this.widthW>t-this.constraintPad.right&&(n=t-this.constraintPad.right-i-this.widthE-this.widthW)}return n},_updateHeightConstraint:function(n){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:getDimensions(this.options.parent).height,i=parseFloat(this.element.css("top"));i+n+this.heightN+this.heightS>t-this.constraintPad.bottom&&(n=t-this.constraintPad.bottom-i-this.heightN-this.heightS)}return n},_createWindow:function(n){var t=this.options.className,i=$(document.createElement("div")),r;i.attr("id",n);i.addClass("dialog");r=this.options.url?'<iframe frameborder="0" name="'+n+'_content"  id="'+n+'_content" src="'+this.options.url+'"> <\/iframe>':'<div id="'+n+'_content" class="'+t+'_content"> <\/div>';var u=this.options.closable?"<div class='"+t+"_close' id='"+n+"_close' onclick='Windows.close(\""+n+"\", event)'> <\/div>":"",f=this.options.minimizable?"<div class='"+t+"_minimize' id='"+n+"_minimize' onclick='Windows.minimize(\""+n+"\", event)'> <\/div>":"",e=this.options.maximizable?"<div class='"+t+"_maximize' id='"+n+"_maximize' onclick='Windows.maximize(\""+n+"\", event)'> <\/div>":"",o=this.options.resizable?"class='"+t+"_sizer' id='"+n+"_sizer'":"class='"+t+"_se'";i.html(u+f+e+"      <table id='"+n+"_row1' class=\"wxtop table_window\">        <tr>          <td class='"+t+"_nw'><\/td>          <td class='"+t+"_n'><div id='"+n+"_top' class='"+t+"_title title_window'>"+this.options.title+"<\/div><\/td>          <td class='"+t+"_ne'><\/td>        <\/tr>      <\/table>      <table id='"+n+"_row2' class=\"mid table_window\">        <tr>          <td class='"+t+"_w'><\/td>            <td id='"+n+"_table_content' class='"+t+"_content' valign='top'>"+r+"<\/td>          <td class='"+t+"_e'><\/td>        <\/tr>      <\/table>        <table id='"+n+"_row3' class=\"bot table_window\">        <tr>          <td class='"+t+"_sw'><\/td>            <td class='"+t+"_s'><div id='"+n+"_bottom' class='status_bar'><span style='float:left; width:1px; height:1px'><\/span><\/div><\/td>            <td "+o+"><\/td>        <\/tr>      <\/table>    ");i.hide();i.insertBefore(this.options.parent.firstChild);$("#"+n+"_content").on("load",this.options.onload);return $(i)},changeClassName:function(n){var t=this.options.className,i=this.getId(),r=this;$A(["_close","_minimize","_maximize","_sizer","_content"]).each(function(u){r._toggleClassName($("#"+i+u),t+u,n+u)});$("#"+i+" td").each(function(i,r){r[0].className=r[0].className.sub(t,n)});this.options.className=n},_toggleClassName:function(n,t,i){n&&(n.removeClass(t),n.addClass(i))},setLocation:function(n,t){n=this._updateTopConstraint(n);t=this._updateLeftConstraint(t);this.element.css({top:n+"px"});this.element.css({left:t+"px"});this.useLeft=!0;this.useTop=!0},getLocation:function(){var n={};return n=this.useTop?Object.extend(n,{top:this.element.css("top")}):Object.extend(n,{bottom:this.element.css("bottom")}),this.useLeft?Object.extend(n,{left:this.element.css("left")}):Object.extend(n,{right:this.element.css("right")})},getSize:function(){return{width:this.width,height:this.height}},setSize:function(n,t){var i,r;n=parseFloat(n);t=parseFloat(t);n<this.options.minWidth&&(n=this.options.minWidth);t<this.options.minHeight&&(t=this.options.minHeight);this.options.maxHeight&&t>this.options.maxHeight&&(t=this.options.maxHeight);this.options.maxWidth&&n>this.options.maxWidth&&(n=this.options.maxWidth);this.width=n;this.height=t;i=this.currentDrag?this.currentDrag:this.element;i.css({width:n+this.widthW+this.widthE+"px"});i.css({height:t+this.heightN+this.heightS+"px"});this.currentDrag&&this.currentDrag!=this.element||(r=$("#"+this.getId()+"_content"),r.css({height:t+"px"}),r.css({width:n+"px"}))},updateHeight:function(){this.setSize(this.width,this.content.scrollHeight)},updateWidth:function(){this.setSize(this.content.scrollWidth,this.height)},toFront:function(){Windows.focusedWindow!=this&&(this.setZIndex(Windows.maxZIndex+20),this._notify("onFocus"),this.iefix&&this._fixIEOverlapping())},show:function(n){if(n&&(Windows.addModalWindow(this),this.modal=!0,this.setZIndex(Windows.maxZIndex+20),Windows.unsetOverflow(this)),this.oldStyle&&this.getContent().css({overflow:this.oldStyle}),!this.width||!this.height){var t=WindowUtilities._computeSize(this.content.html(),this.content.attr("id"),this.width,this.height,0,this.options.className);this.height?this.width=t+5:this.height=t+5}this.setSize(this.width,this.height);this.centered&&this._center(this.centerTop,this.centerLeft);this._notify("onBeforeShow");this.element.show();this._checkIEOverlapping();this.visible=!0;WindowUtilities.focusedWindow=this;this._notify("onShow")},showCenter:function(n,t,i){this.centered=!0;this.centerTop=t;this.centerLeft=i;this.show(n)},isVisible:function(){return this.visible},_center:function(n,t){var i=WindowUtilities.getWindowScroll(),r=WindowUtilities.getPageSize();n||(n=(r.windowHeight-(this.height+this.heightN+this.heightS))/2);n+=i.top;t||(t=(r.windowWidth-(this.width+this.widthW+this.widthE))/2);t+=i.left;this.setLocation(n,t);this.toFront()},_recenter:function(){if(this.modal&&this.centered){var n=WindowUtilities.getPageSize();if(this.pageSize&&this.pageSize.pageWidth==n.windowWidth&&this.pageSize.pageHeight==n.windowHeight)return;this.pageSize=n;$("#overlay_modal")&&$("#overlay_modal").css({height:n.pageHeight+"px",width:n.pageWidth+"px"});this.options.recenterAuto&&this._center(this.centerTop,this.centerLeft)}},hide:function(){this.visible=!1;this.modal&&(Windows.removeModalWindow(this),Windows.resetOverflow());this.oldStyle=this.getContent().css("overflow")||"auto";this.getContent().css({overflow:"hidden"});this.element.hide();this.options.destroyOnClose&&this.destroy();this.iefix&&this.iefix.hide();this.doNotNotifyHide||this._notify("onHide")},close:function(){if(this.visible){if(this.options.closeCallback&&!this.options.closeCallback(this))return;Windows.updateFocusedWindow();this.doNotNotifyHide=!0;this.hide();this.doNotNotifyHide=!1;this._notify("onClose")}},minimize:function(){var t=$("#"+this.getId()+"_row2"),n=getDimensions(t).height,i,r;t.visible()?(i=this.element.getHeight()-n,this.height-=n,t.hide(),this.element.css({height:i+"px"}),this.useTop||(r=parseFloat(this.element.css("bottom")),this.element.css({bottom:r+n+"px"}))):(i=this.element.getHeight()+n,this.height+=n,this.element.css({height:i+"px"}),this.useTop||(r=parseFloat(this.element.css("bottom")),this.element.css({bottom:r-n+"px"})),t.show(),this.toFront());this._notify("onMinimize");this._saveCookie()},maximize:function(){var u;if(!this.isMinimized()){if(isIE&&this.heightN==0&&this._getWindowBorderSize(),this.storedLocation!=null)this._restoreLocation(),this.iefix&&this.iefix.hide();else{this._storeLocation();Windows.unsetOverflow(this);var r=WindowUtilities.getWindowScroll(),n=WindowUtilities.getPageSize(),t=r.left,i=r.top;this.options.parent!=document.body&&(r={top:0,left:0,bottom:0,right:0},u=getDimensions(this.options.parent),n.windowWidth=u.width,n.windowHeight=u.height,i=0,t=0);this.constraint&&(n.windowWidth-=Math.max(0,this.constraintPad.left)+Math.max(0,this.constraintPad.right),n.windowHeight-=Math.max(0,this.constraintPad.top)+Math.max(0,this.constraintPad.bottom),t+=Math.max(0,this.constraintPad.left),i+=Math.max(0,this.constraintPad.top));this.element.css(this.useLeft?{left:t}:{right:t});this.element.css(this.useTop?{top:i}:{bottom:i});this.setSize(n.windowWidth-this.widthW-this.widthE,n.windowHeight-this.heightN-this.heightS);this.toFront();this.iefix&&this._fixIEOverlapping()}this._notify("onMaximize");this._saveCookie()}},isMinimized:function(){var n=$("#"+this.getId()+"_row2");return!n.is(":visible")},isMaximized:function(){return this.storedLocation!=null},setOpacity:function(n){this.element.css("opacity",n)},setZIndex:function(n){this.element.css({zIndex:n});Windows.updateZindex(n,this)},setTitle:function(n){n&&n!=""||(n="&nbsp;");$("#"+this.getId()+"_top").html(n)},setStatusBar:function(n){var t=$("#"+this.getId()+"_bottom");typeof n=="object"?this.bottombar.firstChild?this.bottombar.replaceChild(n,this.bottombar.firstChild):this.bottombar.appendChild(n):this.bottombar.html(n)},_checkIEOverlapping:function(){!this.iefix&&navigator.appVersion.indexOf("MSIE")>0&&navigator.userAgent.indexOf("Opera")<0&&this.element.css("position")=="absolute"&&($("#"+this.getId()).append('<iframe id="'+this.getId()+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"><\/iframe>'),this.iefix=$("#"+this.getId()+"_iefix"));this.iefix&&setTimeout(this._fixIEOverlapping.bind(this),50)},_fixIEOverlapping:function(){Position.clone(this.element,this.iefix);this.iefix.css("z-index",this.element.css("z-index")-1);this.iefix.show()},_getWindowBorderSize:function(){var n=this._createHiddenDiv(this.options.className+"_n");this.heightN=getDimensions(n).height;$(n).remove();n=this._createHiddenDiv(this.options.className+"_s");this.heightS=getDimensions(n).height;$(n).remove();n=this._createHiddenDiv(this.options.className+"_e");this.widthE=getDimensions(n).width;$(n).remove();n=this._createHiddenDiv(this.options.className+"_w");this.widthW=getDimensions(n).width;$(n).remove();isIE&&(this.heightS=getDimensions($("#"+this.getId()+"_row3")).height,this.heightN=getDimensions($("#"+this.getId()+"_row1")).height);/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&this.setSize(this.width,this.height);this.doMaximize&&this.maximize();this.doMinimize&&this.minimize()},_createHiddenDiv:function(n){var i=document.body,t=$(document.createElement("div"));return t.attr("id",this.element.attr("id")+"_tmp"),t.addClass(n),t.hide(),t.html(""),t.insertBefore(i.firstChild),t},_storeLocation:function(){this.storedLocation==null&&(this.storedLocation={useTop:this.useTop,useLeft:this.useLeft,top:this.element.css("top"),bottom:this.element.css("bottom"),left:this.element.css("left"),right:this.element.css("right"),width:this.width,height:this.height})},_restoreLocation:function(){this.storedLocation!=null&&(this.useLeft=this.storedLocation.useLeft,this.useTop=this.storedLocation.useTop,this.element.css(this.useLeft?{left:this.storedLocation.left}:{right:this.storedLocation.right}),this.element.css(this.useTop?{top:this.storedLocation.top}:{bottom:this.storedLocation.bottom}),this.setSize(this.storedLocation.width,this.storedLocation.height),Windows.resetOverflow(),this._removeStoreLocation())},_removeStoreLocation:function(){this.storedLocation=null},_saveCookie:function(){if(this.cookie){var n="";n+=this.useLeft?"l:"+(this.storedLocation?this.storedLocation.left:this.element.css("left")):"r:"+(this.storedLocation?this.storedLocation.right:this.element.css("right"));n+=this.useTop?",t:"+(this.storedLocation?this.storedLocation.top:this.element.css("top")):",b:"+(this.storedLocation?this.storedLocation.bottom:this.element.css("bottom"));n+=","+(this.storedLocation?this.storedLocation.width:this.width);n+=","+(this.storedLocation?this.storedLocation.height:this.height);n+=","+this.isMinimized();n+=","+this.isMaximized();WindowUtilities.setCookie(n,this.cookie)}},_createWiredElement:function(){var n,t;return this.wiredElement||(isIE&&this._getWindowBorderSize(),n=$(document.createElement("div")),n.addClass("wired_frame "+this.options.className+"_wired_frame"),n.css("position","absolute"),n.insertBefore(this.options.parent.firstChild),this.wiredElement=$(n)),this.useLeft?this.wiredElement.css({left:this.element.css("left")}):this.wiredElement.css({right:this.element.css("right")}),this.useTop?this.wiredElement.css({top:this.element.css("top")}):this.wiredElement.css({bottom:this.element.css("bottom")}),t=getDimensions(this.element),this.wiredElement.css({width:t.width+"px",height:t.height+"px"}),this.wiredElement.css({zIndex:Windows.maxZIndex+30}),this.wiredElement},_hideWiredElement:function(){this.wiredElement&&this.currentDrag&&(this.currentDrag==this.element?this.currentDrag=null:(this.useLeft?this.element.css({left:this.currentDrag.css("left")}):this.element.css({right:this.currentDrag.css("right")}),this.useTop?this.element.css({top:this.currentDrag.css("top")}):this.element.css({bottom:this.currentDrag.css("bottom")}),this.currentDrag.hide(),this.currentDrag=null,this.doResize&&this.setSize(this.width,this.height)))},_notify:function(n){this.options[n]?this.options[n](this):Windows.notify(n,this)}};var Windows={windows:[],modalWindows:[],observers:[],focusedWindow:null,maxZIndex:0,addObserver:function(n){this.removeObserver(n);this.observers.push(n)},removeObserver:function(n){this.observers=this.observers.reject(function(t){return t==n})},notify:function(n,t){this.observers.each(function(i){i[n]&&i[n](n,t)})},getWindow:function(n){return this.windows.detect(function(t){return t.getId()==n})},getFocusedWindow:function(){return this.focusedWindow},updateFocusedWindow:function(){this.focusedWindow=this.windows.length>=2?this.windows[this.windows.length-2]:null},getLastWindowByCTagName:function(n){for(var t=this.windows.length-1;t>=0;t--)if(this.windows[t].cTagName&&this.windows[t].cTagName==n)return this.windows[t];return null},register:function(n){this.windows.push(n)},addModalWindow:function(n){this.modalWindows.length==0?WindowUtilities.disableScreen(n.options.className,"overlay_modal",n.getId()):(Window.keepMultiModalWindow?($("#overlay_modal").css("z-index",Windows.maxZIndex+20),Windows.maxZIndex+=20,WindowUtilities._hideSelect(this.modalWindows.last().getId())):this.modalWindows.last().element.hide(),WindowUtilities._showSelect(n.getId()));this.modalWindows.push(n)},removeModalWindow:function(){this.modalWindows.pop();this.modalWindows.length==0?WindowUtilities.enableScreen():Window.keepMultiModalWindow?(this.modalWindows.last().toFront(),WindowUtilities._showSelect(this.modalWindows.last().getId())):this.modalWindows.last().element.show()},register:function(n){this.windows.push(n)},unregister:function(n){this.windows=this.windows.reject(function(t){return t==n})},closeAll:function(){this.windows.each(function(n){Windows.close(n.getId())})},closeAllModalWindows:function(){WindowUtilities.enableScreen();this.modalWindows.each(function(n){n.hide()})},minimize:function(n,t){var i=this.getWindow(n);i&&i.visible&&i.minimize();t.stopPropagation()},maximize:function(n,t){var i=this.getWindow(n);i&&i.visible&&i.maximize();t.stopPropagation()},close:function(n,t){var i=this.getWindow(n);i&&i.close();t&&t.stopPropagation()},unsetOverflow:function(n){this.windows.each(function(n){n.oldOverflow=n.getContent().css("overflow")||"auto";n.getContent().css({overflow:"hidden"})});n&&n.oldOverflow&&n.getContent().css({overflow:n.oldOverflow})},resetOverflow:function(){this.windows.each(function(n){n.oldOverflow&&n.getContent().css({overflow:n.oldOverflow})})},updateZindex:function(n,t){n>this.maxZIndex&&(this.maxZIndex=n);this.focusedWindow=t}},Dialog={dialogId:null,onCompleteFunc:null,callFunc:null,parameters:null,confirm:function(n,t){var i,r;if(n&&typeof n!="string"){Dialog._runAjaxRequest(n,t,Dialog.confirm);return}n=n||"";t=t||{};i=t.okLabel?t.okLabel:"Ok";r=t.cancelLabel?t.cancelLabel:"Cancel";t=Object.extend(t,t.windowParameters||{});t.windowParameters=t.windowParameters||{};t.className=t.className||"alert";var u="class ='"+(t.buttonClass?t.buttonClass+" ":"")+" ok_button'",f="class ='"+(t.buttonClass?t.buttonClass+" ":"")+" cancel_button'",n="      <div class='"+t.className+"_message'>"+n+"<\/div>        <div class='"+t.className+"_buttons'>          <input type='button' value='"+i+"' onclick='Dialog.okCallback()' "+u+"/>          <input type='button' value='"+r+"' onclick='Dialog.cancelCallback()' "+f+"/>        <\/div>    ";return this._openDialog(n,t)},alert:function(n,t){var i,r,n;if(n&&typeof n!="string"){Dialog._runAjaxRequest(n,t,Dialog.alert);return}return n=n||"",t=t||{},i=t.okLabel?t.okLabel:"Ok",t=Object.extend(t,t.windowParameters||{}),t.windowParameters=t.windowParameters||{},t.className=t.className||"alert",r="class ='"+(t.buttonClass?t.buttonClass+" ":"")+" ok_button'",n="      <div class='"+t.className+"_message'>"+n+"<\/div>        <div class='"+t.className+"_buttons'>          <input type='button' value='"+i+"' onclick='Dialog.okCallback()' "+r+"/>        <\/div>",this._openDialog(n,t)},info:function(n,t){if(n&&typeof n!="string"){Dialog._runAjaxRequest(n,t,Dialog.info);return}n=n||"";t=t||{};t=Object.extend(t,t.windowParameters||{});t.windowParameters=t.windowParameters||{};t.className=t.className||"alert";var n="<div id='modal_dialog_message' class='"+t.className+"_message'>"+n+"<\/div>";return t.showProgress&&(n+="<div id='modal_dialog_progress' class='"+t.className+"_progress'>  <\/div>"),t.ok=null,t.cancel=null,this._openDialog(n,t)},setInfoMessage:function(n){$("#modal_dialog_message").update(n)},closeInfo:function(){Windows.close(this.dialogId)},_openDialog:function(n,t){var f=t.className,u,r,i;return t.height||t.width||(t.width=WindowUtilities.getPageSize().pageWidth/2),t.id?this.dialogId=t.id:(u=new Date,this.dialogId="modal_dialog_"+u.getTime(),t.id=this.dialogId),t.height&&t.width||(r=WindowUtilities._computeSize(n,this.dialogId,t.width,t.height,5,f),t.height?t.width=r+5:t.height=r+5),t.effectOptions=t.effectOptions||{duration:1},t.minimizable=!1,t.maximizable=!1,t.closable=!1,i=new Window(t),i.getContent().html(n),i.showCenter(!0,t.top,t.left),i.setDestroyOnClose(),i.cancelCallback=t.onCancel||t.cancel,i.okCallback=t.onOk||t.ok,i},_getAjaxContent:function(n){Dialog.callFunc(n.responseText,Dialog.parameters)},_runAjaxRequest:function(n,t,i){n.options==null&&(n.options={});Dialog.onCompleteFunc=n.options.onComplete;Dialog.parameters=t;Dialog.callFunc=i;n.options.onComplete=Dialog._getAjaxContent;new Ajax.Request(n.url,n.options)},okCallback:function(){var n=Windows.focusedWindow;(!n.okCallback||n.okCallback(n))&&($("#"+n.getId()+" input").each(function(n,t){t.onclick=null}),n.close())},cancelCallback:function(){var n=Windows.focusedWindow;$("#"+n.getId()+" input").each(function(n,t){t.onclick=null});n.close();n.cancelCallback&&n.cancelCallback(n)}},isIE=navigator.appVersion.match(/MSIE/)=="MSIE",WindowUtilities={getWindowScroll:function(){var w=window,W,H;with(w.document)w.innerWidth?(W=w.innerWidth,H=w.innerHeight):w.document.documentElement&&typeof documentElement.clientWidth!="undefined"?(W=documentElement.clientWidth,H=documentElement.clientHeight):(W=body.offsetWidth,H=body.offsetHeight);return{top:$(window).scrollTop(),left:$(window).scrollLeft(),width:W,height:H}},getPageSize:function(){var i,r,n,t,u,f;return window.innerHeight&&window.scrollMaxY?(i=document.body.scrollWidth,r=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(i=document.body.scrollWidth,r=document.body.scrollHeight):(i=document.body.offsetWidth,r=document.body.offsetHeight),self.innerHeight?(n=self.innerWidth,t=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(n=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(n=document.body.clientWidth,t=document.body.clientHeight),u=r<t?t:r,f=i<n?n:i,{pageWidth:f,pageHeight:u,windowWidth:n,windowHeight:t}},disableScreen:function(n,t,i){WindowUtilities.initLightbox(t,n);var f=document.body,u=$("#"+t),r=WindowUtilities.getPageSize();i&&isIE&&(WindowUtilities._hideSelect(),WindowUtilities._showSelect(i));u.css({height:r.pageHeight+"px",width:r.windowWidth+"px",display:"block"})},enableScreen:function(n){n=n||"overlay_modal";var t=$("#"+n);t&&(t.hide(),n!="__invisible__"&&WindowUtilities._showSelect(),t.remove())},_hideSelect:function(n){isIE&&(n=n==null?"":"#"+n+" ",$(n+"select").each(function(n,t){WindowUtilities.isDefined(t.oldVisibility)||(t.oldVisibility=$(t).css("visibility")?$(t).css("visibility"):"visible",$(t).css("visibility","hidden"))}))},_showSelect:function(n){isIE&&(n=n==null?"":"#"+n+" ",$(n+"select").each(function(n,t){if(WindowUtilities.isDefined(t.oldVisibility)){try{$(t).css("visibility",t.oldVisibility)}catch(i){$(t).css("visibility","visible")}t.oldVisibility=null}else $(t).css("visibility")&&$(t).css("visibility","visible")}))},isDefined:function(n){return typeof n!="undefined"&&n!=null},initLightbox:function(n,t){if($("#"+n).length)$("#"+n).css({zIndex:Windows.maxZIndex+10});else{var r=document.body,i=$(document.createElement("div"));i.attr("id",n);i.addClass("overlay_"+t);i.css({display:"none",position:"absolute",top:"0",left:"0",zIndex:Windows.maxZIndex+10,width:"100%"});i.insertBefore(r.firstChild)}},setCookie:function(n,t){document.cookie=t[0]+"="+escape(n)+(t[1]?"; expires="+t[1].toGMTString():"")+(t[2]?"; path="+t[2]:"")+(t[3]?"; domain="+t[3]:"")+(t[4]?"; secure":"")},getCookie:function(n){var i=document.cookie,u=n+"=",t=i.indexOf("; "+u),r;if(t==-1){if(t=i.indexOf(u),t!=0)return null}else t+=2;return r=document.cookie.indexOf(";",t),r==-1&&(r=i.length),unescape(i.substring(t+u.length,r))},_computeSize:function(n,t,i,r,u,f){var s=document.body,e=$(document.createElement("div")),o;return e.attr("id",t),e.addClass(f+"_content"),r?e.css("height",r+"px"):e.css("width",i+"px"),e.css({position:"absolute",top:"0",left:"0",display:"none"}),e.html(n),e.insertBefore(s.firstChild),o=r?getDimensions($("#"+t)).width+u:getDimensions($("#"+t)).height+u,e.remove(),o}};