!function(n){"use strict";var t=function(t,i){this.$ns="bootstrap-markdown";this.$element=n(t);this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null};this.$options=n.extend(!0,{},n.fn.markdown.defaults,i);this.$oldContent=null;this.$isPreview=!1;this.$editor=null;this.$textarea=null;this.$handler=[];this.$callback=[];this.$nextTab=[];this.showEditor()},u,i,r;t.prototype={constructor:t,__alterButtons:function(t,i){var r=this.$handler,u=t=="all",f=this;n.each(r,function(n,r){var e=!0;e=u?!1:r.indexOf(t)<0;e==!1&&i(f.$editor.find('button[data-handler="'+r+'"]'))})},__buildButtons:function(t,i){for(var c=this.$ns,v=this.$handler,y=this.$callback,f,o,e,s,h,u=0;u<t.length;u++)for(o=t[u],f=0;f<o.length;f++){for(s=o[f].data,h=n("<div/>",{"class":"btn-group"}),e=0;e<s.length;e++){var r=s[e],l="",a=c+"-"+r.name,p=r.btnText?r.btnText:"",w=r.btnClass?r.btnClass:"btn",b=r.tabIndex?r.tabIndex:"-1";r.toggle==!0&&(l=' data-toggle="button"');h.append('<button class="'+w+' btn-small" title="'+r.title+'" tabindex="'+b+'" data-provider="'+c+'" data-handler="'+a+'"'+l+'><i class="'+r.icon+'"><\/i> '+p+"<\/button>");v.push(a);y.push(r.callback)}i.append(h)}return i},__setListener:function(){var t=typeof this.$textarea.attr("rows")!="undefined",i=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",r=t?this.$textarea.attr("rows"):i;this.$textarea.attr("rows",r);this.$textarea.css("resize","none");this.$textarea.on("focus",n.proxy(this.focus,this)).on("keypress",n.proxy(this.keypress,this)).on("keyup",n.proxy(this.keyup,this));if(this.eventSupported("keydown"))this.$textarea.on("keydown",n.proxy(this.keydown,this));this.$textarea.data("markdown",this)},__handle:function(t){var r=n(t.currentTarget),u=this.$handler,f=this.$callback,i=r.attr("data-handler"),e=u.indexOf(i),o=f[e];n(t.currentTarget).focus();o(this);i.indexOf("cmdSave")<0&&this.$textarea.focus();t.preventDefault()},showEditor:function(){var l=this,u,a=this.$ns,t=this.$element,p=t.css("height"),w=t.css("width"),f=this.$editable,v=this.$handler,y=this.$callback,i=this.$options,r=n("<div/>",{"class":"md-editor",click:function(){l.focus()}}),e,h,c,o,s;if(this.$editor==null){e=n("<div/>",{"class":"md-header"});i.buttons.length>0&&(e=this.__buildButtons(i.buttons,e));i.additionalButtons.length>0&&(e=this.__buildButtons(i.additionalButtons,e));r.append(e);t.is("textarea")?(t.before(r),u=t,u.addClass("md-input"),r.append(u)):(h=typeof toMarkdown=="function"?toMarkdown(t.html()):t.html(),c=n.trim(h),u=n("<textarea/>",{"class":"md-input",val:c}),r.append(u),f.el=t,f.type=t.prop("tagName").toLowerCase(),f.content=t.html(),n(t[0].attributes).each(function(){f.attrKeys.push(this.nodeName);f.attrValues.push(this.nodeValue)}),t.replaceWith(r));i.savable&&(o=n("<div/>",{"class":"md-footer"}),s="cmdSave",v.push(s),y.push(i.onSave),o.append('<button class="btn btn-success" data-provider="'+a+'" data-handler="'+s+'"><i class="icon icon-white icon-ok"><\/i> Save<\/button>'),r.append(o));n.each(["height","width"],function(n,t){i[t]!="inherit"&&(jQuery.isNumeric(i[t])?r.css(t,i[t]+"px"):r.addClass(i[t]))});this.$editor=r;this.$textarea=u;this.$editable=f;this.$oldContent=this.getContent();this.__setListener();this.$editor.attr("id",(new Date).getTime());this.$editor.on("click",'[data-provider="bootstrap-markdown"]',n.proxy(this.__handle,this))}else this.$editor.show();i.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active"));i.onShow(this);return this},showPreview:function(){var e=this.$options,u=e.onPreview(this),t=this.$textarea,r=t.next(),i=n("<div/>",{"class":"md-preview","data-provider":"markdown-preview"}),f;return this.$isPreview=!0,this.disableButtons("all").enableButtons("cmdPreview"),f=typeof u=="string"?u:typeof markdown=="object"?markdown.toHTML(t.val()):t.val(),i.html(f),r&&r.attr("class")=="md-footer"?i.insertBefore(r):t.parent().append(i),t.hide(),i.data("markdown",this),this},hidePreview:function(){this.$isPreview=!1;var n=this.$editor.find('div[data-provider="markdown-preview"]');return n.remove(),this.enableButtons("all"),this.$textarea.show(),this.__setListener(),this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(n){return this.$textarea.val(n),this},findSelection:function(n){var u=this.getContent(),t,i,r;return(t=u.indexOf(n),t>=0&&n.length>0)?(i=this.getSelection(),this.setSelection(t,t+n.length),r=this.getSelection(),this.setSelection(i.start,i.end),r):null},getSelection:function(){var n=this.$textarea[0];return("selectionStart"in n&&function(){var t=n.selectionEnd-n.selectionStart;return{start:n.selectionStart,end:n.selectionEnd,length:t,text:n.value.substr(n.selectionStart,t)}}||function(){return null})()},setSelection:function(n,t){var i=this.$textarea[0];return("selectionStart"in i&&function(){i.selectionStart=n;i.selectionEnd=t;return}||function(){return null})()},replaceSelection:function(n){var t=this.$textarea[0];return("selectionStart"in t&&function(){return t.value=t.value.substr(0,t.selectionStart)+n+t.value.substr(t.selectionEnd,t.value.length),t.selectionStart=t.value.length,this}||function(){return t.value+=n,jQuery(t)})()},getNextTab:function(){if(this.$nextTab.length==0)return null;var t,n=this.$nextTab.shift();return typeof n=="function"?t=n():typeof n=="object"&&n.length>0&&(t=n),t},setNextTab:function(n,t){var r,i;typeof n=="string"?(r=this,this.$nextTab.push(function(){return r.findSelection(n)})):typeof n=="numeric"&&typeof t=="numeric"&&(i=this.getSelection(),this.setSelection(n,t),this.$nextTab.push(this.getSelection()),this.setSelection(i.start,i.end));return},enableButtons:function(n){var t=function(n){n.removeAttr("disabled")};return this.__alterButtons(n,t),this},disableButtons:function(n){var t=function(n){n.attr("disabled","disabled")};return this.__alterButtons(n,t),this},eventSupported:function(n){var t=n in this.$element;return t||(this.$element.setAttribute(n,"return;"),t=typeof this.$element[n]=="function"),t},keydown:function(t){this.suppressKeyPressRepeat=~n.inArray(t.keyCode,[40,38,9,13,27]);this.keyup(t)},keypress:function(n){this.suppressKeyPressRepeat||this.keyup(n)},keyup:function(n){var t=!1,i,u,r;switch(n.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:(i=this.getNextTab(),i!=null)?(u=this,setTimeout(function(){u.setSelection(i.start,i.end)},500),t=!0):(r=this.getSelection(),r.start==r.end&&r.end==this.getContent().length?t=!1:(this.setSelection(this.getContent().length,this.getContent().length),t=!0));break;case 13:case 27:t=!1;break;default:t=!1}t&&(n.stopPropagation(),n.preventDefault())},focus:function(){var i=this.$options,r=i.hideable,t=this.$editor;return t.addClass("active"),n(document).find(".md-editor").each(function(){if(n(this).attr("id")!=t.attr("id")){var i;(i=n(this).find("textarea").data("markdown"),i==null)&&(i=n(this).find('div[data-provider="markdown-preview"]').data("markdown"));i&&i.blur()}}),this},blur:function(){var u=this.$options,e=u.hideable,i=this.$editor,t=this.$editable;if(i.hasClass("active")||this.$element.parent().length==0){if(i.removeClass("active"),e)if(t.el!=null){var r=n("<"+t.type+"/>"),f=this.getContent(),o=typeof markdown=="object"?markdown.toHTML(f):f;n(t.attrKeys).each(function(n){r.attr(t.attrKeys[n],t.attrValues[n])});r.html(o);i.replaceWith(r)}else i.hide();u.onBlur(this)}return this}};u=n.fn.markdown;n.fn.markdown=function(i){return this.each(function(){var r=n(this),u=r.data("markdown"),f=typeof i=="object"&&i;u||r.data("markdown",u=new t(this,f))})};n.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",buttons:[[{name:"groupFont",data:[{name:"cmdBold",title:"Bold",icon:"icon icon-bold",callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length==0?"strong text":t.text;u.substr(t.start-2,2)=="**"&&u.substr(t.end,2)=="**"?(n.setSelection(t.start-2,t.end+2),n.replaceSelection(i),r=t.start-2):(n.replaceSelection("**"+i+"**"),r=t.start+2);n.setSelection(r,r+i.length)}},{name:"cmdItalic",title:"Italic",icon:"icon icon-italic",callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length==0?"emphasized text":t.text;u.substr(t.start-1,1)=="*"&&u.substr(t.end,1)=="*"?(n.setSelection(t.start-1,t.end+1),n.replaceSelection(i),r=t.start-1):(n.replaceSelection("*"+i+"*"),r=t.start+1);n.setSelection(r,r+i.length)}},{name:"cmdHeading",title:"Heading",icon:"icon icon-font",callback:function(n){var r,u,t=n.getSelection(),f=n.getContent(),i,e;r=t.length==0?"heading text":t.text;(i=4,f.substr(t.start-i,i)=="### ")||(i=3,f.substr(t.start-i,i)=="###")?(n.setSelection(t.start-i,t.end),n.replaceSelection(r),u=t.start-i):(e=f.substr(t.start-1,1),!e||e=="\n")?(n.replaceSelection("### "+r+"\n"),u=t.start+4):(n.replaceSelection("\n\n### "+r+"\n"),u=t.start+6);n.setSelection(u,u+r.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",icon:"icon icon-globe",callback:function(n){var t,i,r=n.getSelection(),u=n.getContent();t=r.length==0?"enter link description here":r.text;bootbox.prompt("Insert Hyperlink",function(u){u!=null&&(n.replaceSelection("["+t+"]("+u+")"),i=r.start+1,n.setSelection(i,i+t.length))})}},{name:"cmdImage",title:"Image",icon:"icon icon-picture",callback:function(n){var t,i,r=n.getSelection(),u=n.getContent();t=r.length==0?"enter image description here":r.text;bootbox.prompt("Insert Image Hyperlink",function(u){u!=null&&(n.replaceSelection("!["+t+"]("+u+' "enter image title here")'),i=r.start+2,n.setNextTab("enter image title here"),n.setSelection(i,i+t.length))})}}]},{name:"groupMisc",data:[{name:"cmdList",title:"List",icon:"icon icon-list",callback:function(t){var r,f,i=t.getSelection(),e=t.getContent(),u;i.length==0?(r="list text here",t.replaceSelection("- "+r),f=i.start+2):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("- "+r),f=i.start+2):(u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]="- "+t}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+4);t.setSelection(f,f+r.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,title:"Preview",btnText:"Preview",btnClass:"btn btn-inverse",icon:"icon icon-white icon-search",callback:function(n){var t=n.$isPreview;t==!1?n.showPreview():n.hidePreview()}}]}]],additionalButtons:[],onShow:function(){},onPreview:function(){},onSave:function(){},onBlur:function(){}};n.fn.markdown.Constructor=t;n.fn.markdown.noConflict=function(){return n.fn.markdown=u,this};i=function(n){var t=n;if(t.data("markdown")){t.data("markdown").showEditor();return}t.markdown(t.data())};r=function(t){var r=!1,i,u=n(t.currentTarget);(t.type=="focusin"||t.type=="click")&&u.length==1&&typeof u[0]=="object"&&(i=u[0].activeElement,n(i).data("markdown")||(typeof n(i).parent().parent().parent().attr("class")=="undefined"||n(i).parent().parent().parent().attr("class").indexOf("md-editor")<0?(typeof n(i).parent().parent().attr("class")=="undefined"||n(i).parent().parent().attr("class").indexOf("md-editor")<0)&&(r=!0):r=!1),r&&n(document).find(".md-editor").each(function(){var r=n(i).parent(),t;n(this).attr("id")!=r.attr("id")&&((t=n(this).find("textarea").data("markdown"),t==null)&&(t=n(this).find('div[data-provider="markdown-preview"]').data("markdown")),t&&t.blur())}),t.stopPropagation())};n(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(t){i(n(this));t.preventDefault()}).on("click",function(n){r(n)}).on("focusin",function(n){r(n)}).ready(function(){n('textarea[data-provide="markdown"]').each(function(){i(n(this))})})}(window.jQuery);
/*
//# sourceMappingURL=bootstrap-markdown.min.js.map
*/